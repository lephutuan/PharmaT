<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n L√Ω Ti·ªám Thu·ªëc T·ª± ƒê·ªông - ƒê∆°n Thu·ªëc</title>
    <link rel="stylesheet" href="../assets/css/prescriptions.css" />
    <link rel="stylesheet" href="../assets/css/api-styles.css" />
    <link rel="stylesheet" href="../assets/css/common-responsive.css" />
    <!-- Awesomplete CSS & JS CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar">
      <div class="menu-toggle" onclick="toggleSidebar()">
        <i class="fa-solid fa-bars"></i>
      </div>
      <div class="logo">
        <img src="../assets/images/logo.png" alt="PharmaT Logo" class="logo-img" onclick="window.location.href='home.html'">
      </div>
      <div class="page-title">
        <h1>ƒê∆°n thu·ªëc</h1>
      </div>
    </nav>

    <!-- Sidebar -->
    <aside class="sidebar">
      <ul>
        <li>
          <a href="home.html" onclick="setActive(this)">üè† Trang ch·ªß</a>
        </li>
        <li>
          <a href="warehouse.html" onclick="setActive(this)">üì¶ Kho thu·ªëc</a>
        </li>
        <li>
          <a href="prescriptions.html" onclick="setActive(this)">üìù ƒê∆°n thu·ªëc</a>
        </li>
        <li>
          <a href="employees.html" onclick="setActive(this)">üë• Nh√¢n vi√™n</a>
        </li>
        <li><a href="checkout.html" onclick="setActive(this)">üí≥ Thanh to√°n</a></li>
        <li>
          <a href="reports.html" onclick="setActive(this)">üìà B√°o c√°o & Th·ªëng k√™</a>
        </li>
        <li>
          <a href="chatbox.html" onclick="setActive(this)">ü§ñ Chatbox c·∫£nh b√°o</a>
        </li>
      </ul>
      
      <!-- Logout Button -->
      <div class="sidebar-footer">
        <a href="login.html" class="logout-btn" onclick="logout()">
          <i class="fa-solid fa-sign-out-alt"></i>
          ƒêƒÉng xu·∫•t
        </a>
      </div>
    </aside>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>

    <!-- Main Content -->
    <main>

    <!-- 1. Th√¥ng tin kh√°ch h√†ng v√† nh√¢n vi√™n -->
    <section class="form-section">
      <h2>Th√¥ng tin kh√°ch h√†ng v√† nh√¢n vi√™n</h2>
      <div class="customer-form">
        <div style="margin-bottom: 15px;">
          <label for="customerSelect" style="display: block; margin-bottom: 5px; font-weight: bold;">Kh√°ch h√†ng:</label>
          <select id="customerSelect">
            <option value="">-- Ch·ªçn kh√°ch h√†ng --</option>
            <!-- C√°c option s·∫Ω ƒë∆∞·ª£c render t·ª´ JS -->
          </select>
          <button class="btn btn-secondary" id="btnAddCustomer">+ Th√™m kh√°ch h√†ng m·ªõi</button>
        </div>
        <div id="addCustomerForm" style="display:none; gap: 8px; align-items: center; margin-top: 8px;">
          <input type="text" id="newCustomerName" placeholder="T√™n kh√°ch h√†ng" style="width: 180px;" />
          <input type="text" id="newCustomerPhone" placeholder="SƒêT" style="width: 120px;" />
          <input type="text" id="newCustomerAllergy" placeholder="D·ªã ·ª©ng (n·∫øu c√≥)" style="width: 180px;" />
          <button class="btn btn-primary" id="btnSaveCustomer"><i class="fa fa-save"></i> L∆∞u</button>
          <button class="btn btn-danger" id="btnCancelAddCustomer"><i class="fa fa-times"></i> H·ªßy</button>
        </div>
        
        <div class="customer-info" id="customerInfo">
          <!-- T√™n, sƒët, d·ªã ·ª©ng s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y -->
        </div>
        <div style="margin-bottom: 15px;">
          <label for="employeeSelect" style="display: block; margin-bottom: 5px; font-weight: bold;">Nh√¢n vi√™n th·ª±c hi·ªán:</label>
          <select id="employeeSelect">
            <option value="">-- Ch·ªçn nh√¢n vi√™n --</option>
            <!-- C√°c option s·∫Ω ƒë∆∞·ª£c render t·ª´ JS -->
          </select>
        </div>
        
        <!-- Form th√™m kh√°ch h√†ng m·ªõi, ·∫©n m·∫∑c ƒë·ªãnh -->
        
      </div>
    </section>

    <!-- 2. Th√™m thu·ªëc v√†o ƒë∆°n -->
    <section class="form-section">
      <h2>Th√™m thu·ªëc v√†o ƒë∆°n</h2>
      <div class="medicine-form">
        <input id="medicineSearch" class="awesomplete" type="text" placeholder="T√¨m thu·ªëc..." autocomplete="off" />
        <input type="text" placeholder="Li·ªÅu l∆∞·ª£ng" id="dose" />
        <input type="number" placeholder="S·ªë ng√†y" id="days" />
        <input type="number" placeholder="S·ªë l∆∞·ª£ng" id="quantity" />
        <button class="btn btn-primary" onclick="addMedicine()">+ Th√™m thu·ªëc</button>
      </div>
    </section>

    <!-- 3. Danh s√°ch thu·ªëc trong ƒë∆°n -->
    <section class="form-section">
      <h2>Danh s√°ch thu·ªëc</h2>
      <table class="medicine-table">
        <thead>
          <tr>
            <th>STT</th>
            <th>T√™n thu·ªëc</th>
            <th>Li·ªÅu d√πng</th>
            <th>S·ªë ng√†y</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>X√≥a</th>
          </tr>
        </thead>
        <tbody id="medicineList">
          <!-- JS render thu·ªëc t·∫°i ƒë√¢y -->
        </tbody>
      </table>
    </section>

    <!-- 4. H√†nh ƒë·ªông -->
    <section class="form-section">
      <button class="btn btn-success" onclick="submitPrescription()">üíæ L∆∞u ƒë∆°n thu·ªëc</button>
      <button class="btn btn-danger" onclick="cancelPrescription()">‚ùå H·ªßy</button>
    </section>
  </main>

  </body>
    <script src="../assets/js/sidebar.js"></script>
  <!-- Backend scripts removed for frontend-only version -->
  <script>
    // D·ªØ li·ªáu m·∫´u cho demo
    let selectedMedicines = [];
    let selectedCustomer = null;
    let selectedEmployee = null;

    // D·ªØ li·ªáu m·∫´u
    const sampleCustomers = [
      { id: 1, name: 'Nguy·ªÖn VƒÉn A', phone: '0123456789', allergy: 'Kh√¥ng c√≥' },
      { id: 2, name: 'Tr·∫ßn Th·ªã B', phone: '0987654321', allergy: 'Penicillin' },
      { id: 3, name: 'L√™ VƒÉn C', phone: '0369852147', allergy: 'Aspirin' }
    ];

    const sampleEmployees = [
      { id: 1, name: 'D∆∞·ª£c sƒ© Minh', position: 'D∆∞·ª£c sƒ©' },
      { id: 2, name: 'Nh√¢n vi√™n Lan', position: 'Nh√¢n vi√™n b√°n h√†ng' },
      { id: 3, name: 'D∆∞·ª£c sƒ© H√πng', position: 'D∆∞·ª£c sƒ© tr∆∞·ªüng' }
    ];

    const sampleMedicines = [
      'Paracetamol 500mg',
      'Amoxicillin 500mg', 
      'Vitamin C 1000mg',
      'Efferalgan 500mg',
      'Omeprazole 20mg',
      'Ibuprofen 400mg',
      'Aspirin 100mg',
      'Cetirizine 10mg'
    ];

    // Kh·ªüi t·∫°o khi trang load
    document.addEventListener('DOMContentLoaded', function() {
      initializeAwesomplete();
      populateSelects();
      setupEventListeners();
    });

    // Kh·ªüi t·∫°o Awesomplete
    function initializeAwesomplete() {
      const input = document.getElementById("medicineSearch");
      const awesomplete = new Awesomplete(input, {
        minChars: 1,
        maxItems: 10,
        autoFirst: true,
        filter: function(text, input) {
          return Awesomplete.FILTER_STARTSWITH(text, input);
        }
      });
      
      awesomplete.list = sampleMedicines;

      input.addEventListener('awesomplete-selectcomplete', function(evt) {
        const selectedName = input.value.trim().toLowerCase();
        const medicineData = {
          'paracetamol 500mg': { id: 1, price: 3000 },
          'amoxicillin 500mg': { id: 2, price: 4000 },
          'vitamin c 1000mg': { id: 3, price: 2500 },
          'efferalgan 500mg': { id: 4, price: 3500 },
          'omeprazole 20mg': { id: 5, price: 5000 },
          'ibuprofen 400mg': { id: 6, price: 4500 },
          'aspirin 100mg': { id: 7, price: 2000 },
          'cetirizine 10mg': { id: 8, price: 3000 }
        };
        
        const medicine = medicineData[selectedName];
        if (medicine) {
          input.dataset.selectedId = medicine.id;
          input.dataset.selectedPrice = medicine.price;
        } else {
          delete input.dataset.selectedId;
          delete input.dataset.selectedPrice;
        }
      });
    }

    // Populate selects v·ªõi d·ªØ li·ªáu m·∫´u
    function populateSelects() {
      // Populate customer select
      const customerSelect = document.getElementById('customerSelect');
      customerSelect.innerHTML = '<option value="">-- Ch·ªçn kh√°ch h√†ng --</option>';
      sampleCustomers.forEach(customer => {
        const option = document.createElement('option');
        option.value = customer.id;
        option.textContent = `${customer.name} - ${customer.phone}`;
        customerSelect.appendChild(option);
      });

      // Populate employee select
      const employeeSelect = document.getElementById('employeeSelect');
      employeeSelect.innerHTML = '<option value="">-- Ch·ªçn nh√¢n vi√™n --</option>';
      sampleEmployees.forEach(employee => {
        const option = document.createElement('option');
        option.value = employee.id;
        option.textContent = `${employee.name} - ${employee.position}`;
        employeeSelect.appendChild(option);
      });
    }

    // Setup event listeners
    function setupEventListeners() {
      // Customer select change
      document.getElementById('customerSelect').addEventListener('change', function() {
        const customerId = this.value;
        if (customerId) {
          selectedCustomer = sampleCustomers.find(c => c.id == customerId);
          displayCustomerInfo(selectedCustomer);
        } else {
          selectedCustomer = null;
          document.getElementById('customerInfo').innerHTML = '';
        }
      });

      // Employee select change
      document.getElementById('employeeSelect').addEventListener('change', function() {
        const employeeId = this.value;
        if (employeeId) {
          selectedEmployee = sampleEmployees.find(e => e.id == employeeId);
        } else {
          selectedEmployee = null;
        }
      });

      // Add customer button
      document.getElementById('btnAddCustomer').addEventListener('click', function() {
        this.style.display = 'none';
        document.getElementById('addCustomerForm').style.display = 'flex';
      });

      // Cancel add customer
      document.getElementById('btnCancelAddCustomer').addEventListener('click', function() {
        document.getElementById('addCustomerForm').style.display = 'none';
        document.getElementById('btnAddCustomer').style.display = 'inline-block';
        clearAddCustomerForm();
      });

      // Save customer
      document.getElementById('btnSaveCustomer').addEventListener('click', function() {
        const name = document.getElementById('newCustomerName').value.trim();
        const phone = document.getElementById('newCustomerPhone').value.trim();
        const allergy = document.getElementById('newCustomerAllergy').value.trim();
        
        if (!name || !phone) {
          alert('Vui l√≤ng nh·∫≠p t√™n v√† s·ªë ƒëi·ªán tho·∫°i kh√°ch h√†ng!');
          return;
        }

        // Simulate adding customer
        const newCustomer = {
          id: sampleCustomers.length + 1,
          name: name,
          phone: phone,
          allergy: allergy || 'Kh√¥ng c√≥'
        };
        
        sampleCustomers.push(newCustomer);
        populateSelects();
        document.getElementById('customerSelect').value = newCustomer.id;
        selectedCustomer = newCustomer;
        displayCustomerInfo(selectedCustomer);
        
        document.getElementById('addCustomerForm').style.display = 'none';
        document.getElementById('btnAddCustomer').style.display = 'inline-block';
        clearAddCustomerForm();
        
        alert('ƒê√£ th√™m kh√°ch h√†ng m·ªõi!');
      });
    }

    // Clear add customer form
    function clearAddCustomerForm() {
      document.getElementById('newCustomerName').value = '';
      document.getElementById('newCustomerPhone').value = '';
      document.getElementById('newCustomerAllergy').value = '';
    }

    // Display customer info
    function displayCustomerInfo(customer) {
      const infoDiv = document.getElementById('customerInfo');
      infoDiv.innerHTML = `
        <div class="customer-details">
          <p><strong>T√™n:</strong> ${customer.name}</p>
          <p><strong>SƒêT:</strong> ${customer.phone}</p>
          <p><strong>D·ªã ·ª©ng:</strong> ${customer.allergy}</p>
        </div>
      `;
    }

    // Add medicine to prescription
    function addMedicine() {
      const searchInput = document.getElementById('medicineSearch');
      const doseInput = document.getElementById('dose');
      const daysInput = document.getElementById('days');
      const quantityInput = document.getElementById('quantity');

      const medicineId = searchInput.dataset.selectedId;
      const medicineName = searchInput.value;
      const dose = doseInput.value;
      const days = parseInt(daysInput.value);
      const quantity = parseInt(quantityInput.value);

      if (!medicineId || !dose || !days || !quantity) {
        alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin thu·ªëc');
        return;
      }

      const medicine = {
        id: medicineId,
        name: medicineName,
        dose: dose,
        days: days,
        quantity: quantity
      };

      selectedMedicines.push(medicine);
      displayMedicineList();
      clearMedicineForm();
    }

    // Display medicine list
    function displayMedicineList() {
      const tbody = document.getElementById('medicineList');
      tbody.innerHTML = '';

      selectedMedicines.forEach((medicine, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${medicine.name}</td>
          <td>${medicine.dose}</td>
          <td>${medicine.days}</td>
          <td>${medicine.quantity}</td>
          <td><button onclick="removeMedicine(${index})" class="btn btn-danger btn-sm">X√≥a</button></td>
        `;
        tbody.appendChild(row);
      });
    }

    // Remove medicine
    function removeMedicine(index) {
      selectedMedicines.splice(index, 1);
      displayMedicineList();
    }

    // Clear medicine form
    function clearMedicineForm() {
      document.getElementById('medicineSearch').value = '';
      document.getElementById('dose').value = '';
      document.getElementById('days').value = '';
      document.getElementById('quantity').value = '';
      delete document.getElementById('medicineSearch').dataset.selectedId;
      delete document.getElementById('medicineSearch').dataset.selectedPrice;
    }

    // Submit prescription
    function submitPrescription() {
      if (!selectedCustomer) {
        alert('Vui l√≤ng ch·ªçn kh√°ch h√†ng');
        return;
      }

      if (!selectedEmployee) {
        alert('Vui l√≤ng ch·ªçn nh√¢n vi√™n th·ª±c hi·ªán');
        return;
      }

      if (selectedMedicines.length === 0) {
        alert('Vui l√≤ng th√™m thu·ªëc v√†o ƒë∆°n');
        return;
      }

      // Simulate saving prescription
      setTimeout(() => {
        alert('ƒê∆°n thu·ªëc ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng!');
        resetForm();
      }, 500);
    }

    // Cancel prescription
    function cancelPrescription() {
      if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy ƒë∆°n thu·ªëc n√†y?')) {
        resetForm();
      }
    }

    // Reset form
    function resetForm() {
      document.getElementById('customerSelect').value = '';
      document.getElementById('employeeSelect').value = '';
      document.getElementById('medicineList').innerHTML = '';
      selectedMedicines = [];
      selectedCustomer = null;
      selectedEmployee = null;
      document.getElementById('customerInfo').innerHTML = '';
      document.getElementById('addCustomerForm').style.display = 'none';
      document.getElementById('btnAddCustomer').style.display = 'inline-block';
      clearMedicineForm();
    }
  </script>
</html>

