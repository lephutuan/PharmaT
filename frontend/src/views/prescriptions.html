<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n L√Ω Ti·ªám Thu·ªëc T·ª± ƒê·ªông - ƒê∆°n Thu·ªëc</title>
    <link rel="stylesheet" href="../assets/css/prescriptions.css" />
    <link rel="stylesheet" href="../assets/css/api-styles.css" />
    <link rel="stylesheet" href="../assets/css/common-responsive.css" />
    <!-- Awesomplete CSS & JS CDN -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar">
      <div class="menu-toggle" onclick="toggleSidebar()">
        <i class="fa-solid fa-bars"></i>
      </div>
      <div class="logo">
        <img
          src="../assets/images/logo.png"
          alt="PharmaT Logo"
          class="logo-img"
          onclick="window.location.href='../../../index.html'"
        />
      </div>
      <div class="page-title">
        <h1>ƒê∆°n thu·ªëc</h1>
      </div>
    </nav>

    <!-- Sidebar -->
    <aside class="sidebar">
      <ul>
        <li>
          <a href="../../../index.html" onclick="setActive(this)"
            >üè† Trang ch·ªß</a
          >
        </li>
        <li>
          <a href="warehouse.html" onclick="setActive(this)">üì¶ Kho thu·ªëc</a>
        </li>
        <li>
          <a href="prescriptions.html" onclick="setActive(this)"
            >üìù ƒê∆°n thu·ªëc</a
          >
        </li>
        <li>
          <a href="employees.html" onclick="setActive(this)">üë• Nh√¢n vi√™n</a>
        </li>
        <li>
          <a href="members.html" onclick="setActive(this)">üíé H·ªôi vi√™n</a>
        </li>
        <li>
          <a href="checkout.html" onclick="setActive(this)">üí≥ Thanh to√°n</a>
        </li>
        <li>
          <a href="reports.html" onclick="setActive(this)"
            >üìà B√°o c√°o & Th·ªëng k√™</a
          >
        </li>
        <li>
          <a href="chatbox.html" onclick="setActive(this)"
            >ü§ñ Chatbox c·∫£nh b√°o</a
          >
        </li>
      </ul>

      <!-- Logout Button -->
      <div class="sidebar-footer">
        <a href="login.html" class="logout-btn" onclick="logout()">
          <i class="fa-solid fa-sign-out-alt"></i>
          ƒêƒÉng xu·∫•t
        </a>
      </div>
    </aside>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>

    <!-- Main Content -->
    <main>
      <!-- 1. Th√¥ng tin kh√°ch h√†ng v√† nh√¢n vi√™n -->
      <section class="form-section">
        <h2>Th√¥ng tin kh√°ch h√†ng v√† nh√¢n vi√™n</h2>
        <div class="customer-form">
          <!-- Lo·∫°i kh√°ch h√†ng -->
          <div style="margin-bottom: 15px">
            <label style="display: block; margin-bottom: 5px; font-weight: bold"
              >Lo·∫°i kh√°ch h√†ng:</label
            >
            <div style="display: flex; gap: 20px">
              <label style="cursor: pointer">
                <input
                  type="radio"
                  name="customerType"
                  value="vanglai"
                  checked
                  onchange="toggleCustomerType()"
                />
                Kh√°ch v√£ng lai
              </label>
              <label style="cursor: pointer">
                <input
                  type="radio"
                  name="customerType"
                  value="hoivien"
                  onchange="toggleCustomerType()"
                />
                H·ªôi vi√™n
              </label>
            </div>
          </div>

          <!-- Form kh√°ch v√£ng lai -->
          <div id="vanglaiForm" style="margin-bottom: 15px">
            <input
              type="text"
              id="vanglaiName"
              placeholder="T√™n kh√°ch h√†ng (t√πy ch·ªçn)"
              style="width: 250px; margin-right: 10px"
            />
            <input
              type="text"
              id="vanglaiAllergy"
              placeholder="D·ªã ·ª©ng (n·∫øu c√≥)"
              style="width: 250px"
            />
            <p style="color: #666; font-size: 0.9em; margin-top: 5px">
              <i class="fa fa-info-circle"></i> Th√¥ng tin ch·ªâ l∆∞u cho ƒë∆°n n√†y,
              kh√¥ng l∆∞u v√†o h·ªá th·ªëng
            </p>
          </div>

          <!-- Form h·ªôi vi√™n -->
          <div id="hoivienForm" style="display: none; margin-bottom: 15px">
            <div style="margin-bottom: 15px">
              <label
                for="customerSelect"
                style="display: block; margin-bottom: 5px; font-weight: bold"
                >Ch·ªçn h·ªôi vi√™n:</label
              >
              <select id="customerSelect">
                <option value="">-- Ch·ªçn h·ªôi vi√™n --</option>
                <!-- C√°c option s·∫Ω ƒë∆∞·ª£c render t·ª´ JS -->
              </select>
              <button class="btn btn-secondary" id="btnAddCustomer">
                + ƒêƒÉng k√Ω h·ªôi vi√™n m·ªõi
              </button>
            </div>

            <div
              id="addCustomerForm"
              style="
                display: none;
                gap: 8px;
                align-items: center;
                margin-top: 8px;
              "
            >
              <input
                type="text"
                id="newCustomerName"
                placeholder="T√™n kh√°ch h√†ng"
                style="width: 180px"
              />
              <input
                type="text"
                id="newCustomerPhone"
                placeholder="SƒêT"
                style="width: 120px"
              />
              <input
                type="text"
                id="newCustomerAllergy"
                placeholder="D·ªã ·ª©ng (n·∫øu c√≥)"
                style="width: 180px"
              />
              <button class="btn btn-primary" id="btnSaveCustomer">
                <i class="fa fa-save"></i> L∆∞u
              </button>
              <button class="btn btn-danger" id="btnCancelAddCustomer">
                <i class="fa fa-times"></i> H·ªßy
              </button>
            </div>

            <div class="customer-info" id="customerInfo">
              <!-- T√™n, sƒët, d·ªã ·ª©ng, c·∫•p th√†nh vi√™n s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y -->
            </div>
          </div>
          <div style="margin-bottom: 15px">
            <label
              for="employeeSelect"
              style="display: block; margin-bottom: 5px; font-weight: bold"
              >Nh√¢n vi√™n th·ª±c hi·ªán:</label
            >
            <select id="employeeSelect">
              <option value="">-- Ch·ªçn nh√¢n vi√™n --</option>
              <!-- C√°c option s·∫Ω ƒë∆∞·ª£c render t·ª´ JS -->
            </select>
          </div>

          <!-- Form th√™m kh√°ch h√†ng m·ªõi, ·∫©n m·∫∑c ƒë·ªãnh -->
        </div>
      </section>

      <!-- 2. Th√™m thu·ªëc v√†o ƒë∆°n -->
      <section class="form-section">
        <h2>Th√™m thu·ªëc v√†o ƒë∆°n</h2>
        <div class="medicine-form">
          <input
            id="medicineSearch"
            class="awesomplete"
            type="text"
            placeholder="T√¨m thu·ªëc..."
            autocomplete="off"
          />
          <input type="text" placeholder="Li·ªÅu l∆∞·ª£ng" id="dose" />
          <input type="number" placeholder="S·ªë ng√†y" id="days" />
          <input type="number" placeholder="S·ªë l∆∞·ª£ng" id="quantity" />
          <button class="btn btn-primary" onclick="addMedicine()">
            + Th√™m thu·ªëc
          </button>
        </div>
      </section>

      <!-- 3. Danh s√°ch thu·ªëc trong ƒë∆°n -->
      <section class="form-section">
        <h2>Danh s√°ch thu·ªëc</h2>
        <table class="medicine-table">
          <thead>
            <tr>
              <th>STT</th>
              <th>T√™n thu·ªëc</th>
              <th>Li·ªÅu d√πng</th>
              <th>S·ªë ng√†y</th>
              <th>S·ªë l∆∞·ª£ng</th>
              <th>X√≥a</th>
            </tr>
          </thead>
          <tbody id="medicineList">
            <!-- JS render thu·ªëc t·∫°i ƒë√¢y -->
          </tbody>
        </table>
      </section>

      <!-- 4. H√†nh ƒë·ªông -->
      <section class="form-section">
        <button class="btn btn-success" onclick="submitPrescription()">
          üíæ L∆∞u ƒë∆°n thu·ªëc
        </button>
        <button class="btn btn-danger" onclick="cancelPrescription()">
          ‚ùå H·ªßy
        </button>
      </section>
    </main>
  </body>
  <script src="../assets/js/sidebar.js"></script>
  <script src="../config/supabase.js"></script>
  <script src="../config/api.js"></script>
  <script>
    // Bi·∫øn to√†n c·ª•c
    let selectedMedicines = [];
    let selectedCustomer = null;
    let selectedEmployee = null;
    let allCustomers = [];
    let allEmployees = [];
    let allMedicines = [];
    let customerType = "vanglai"; // 'vanglai' ho·∫∑c 'hoivien'

    // Kh·ªüi t·∫°o khi trang load
    document.addEventListener("DOMContentLoaded", async function () {
      try {
        UI.showLoading();
        await loadData();
        initializeAwesomplete();
        setupEventListeners();
      } catch (error) {
        console.error("L·ªói khi kh·ªüi t·∫°o:", error);
        UI.showMessage("L·ªói khi t·∫£i d·ªØ li·ªáu: " + error.message, "error");
      } finally {
        UI.hideLoading();
      }
    });

    // Load d·ªØ li·ªáu t·ª´ database
    async function loadData() {
      try {
        // Load kh√°ch h√†ng
        const customersResponse = await API.getKhachHang();
        allCustomers = customersResponse.records || [];

        // Load nh√¢n vi√™n
        const employeesResponse = await API.getNhanVien();
        allEmployees = employeesResponse.records || [];

        // Load thu·ªëc
        const medicinesResponse = await API.getThuoc();
        allMedicines = medicinesResponse.records || [];

        // Populate selects
        populateSelects();
      } catch (error) {
        console.error("L·ªói khi load d·ªØ li·ªáu:", error);
        throw error;
      }
    }

    // Kh·ªüi t·∫°o Awesomplete
    function initializeAwesomplete() {
      const input = document.getElementById("medicineSearch");

      // T·∫°o danh s√°ch t√™n thu·ªëc t·ª´ database
      const medicineNames = allMedicines.map((m) => m.ten_thuoc);

      const awesomplete = new Awesomplete(input, {
        minChars: 1,
        maxItems: 10,
        autoFirst: true,
        list: medicineNames,
        filter: function (text, input) {
          return Awesomplete.FILTER_CONTAINS(text, input);
        },
      });

      input.addEventListener("awesomplete-selectcomplete", function (evt) {
        const selectedName = input.value.trim();
        const medicine = allMedicines.find((m) => m.ten_thuoc === selectedName);

        if (medicine) {
          input.dataset.selectedId = medicine.ma_thuoc;
          input.dataset.selectedPrice = medicine.gia_ban;
        } else {
          delete input.dataset.selectedId;
          delete input.dataset.selectedPrice;
        }
      });
    }

    // Toggle lo·∫°i kh√°ch h√†ng
    function toggleCustomerType() {
      const type = document.querySelector(
        'input[name="customerType"]:checked'
      ).value;
      customerType = type;

      const vanglaiForm = document.getElementById("vanglaiForm");
      const hoivienForm = document.getElementById("hoivienForm");

      if (type === "vanglai") {
        vanglaiForm.style.display = "block";
        hoivienForm.style.display = "none";
        selectedCustomer = null;
      } else {
        vanglaiForm.style.display = "none";
        hoivienForm.style.display = "block";
      }
    }

    // Populate selects v·ªõi d·ªØ li·ªáu t·ª´ database
    function populateSelects() {
      // Populate customer select (ch·ªâ h·ªôi vi√™n)
      const customerSelect = document.getElementById("customerSelect");
      customerSelect.innerHTML =
        '<option value="">-- Ch·ªçn h·ªôi vi√™n --</option>';

      // Filter ch·ªâ l·∫•y h·ªôi vi√™n
      const hoivienList = allCustomers.filter((c) => c.loai_kh === "H·ªôi vi√™n");

      hoivienList.forEach((customer) => {
        const option = document.createElement("option");
        option.value = customer.ma_kh;
        const cap = customer.cap_thanh_vien || "Bronze";
        const capIcon =
          cap === "VIP"
            ? "üëë"
            : cap === "Gold"
            ? "ü•á"
            : cap === "Silver"
            ? "ü•à"
            : "ü•â";
        option.textContent = `${capIcon} ${customer.ten_kh} - ${customer.sdt} [${cap}]`;
        customerSelect.appendChild(option);
      });

      // Populate employee select
      const employeeSelect = document.getElementById("employeeSelect");
      employeeSelect.innerHTML =
        '<option value="">-- Ch·ªçn nh√¢n vi√™n --</option>';
      allEmployees.forEach((employee) => {
        const option = document.createElement("option");
        option.value = employee.ma_nv;
        option.textContent = `${employee.ten_nv} - ${employee.chuc_vu}`;
        employeeSelect.appendChild(option);
      });
    }

    // Setup event listeners
    function setupEventListeners() {
      // Customer select change
      document
        .getElementById("customerSelect")
        .addEventListener("change", function () {
          const customerId = this.value;
          if (customerId) {
            selectedCustomer = allCustomers.find((c) => c.ma_kh == customerId);
            displayCustomerInfo(selectedCustomer);
          } else {
            selectedCustomer = null;
            document.getElementById("customerInfo").innerHTML = "";
          }
        });

      // Employee select change
      document
        .getElementById("employeeSelect")
        .addEventListener("change", function () {
          const employeeId = this.value;
          if (employeeId) {
            selectedEmployee = allEmployees.find((e) => e.ma_nv == employeeId);
          } else {
            selectedEmployee = null;
          }
        });

      // Add customer button
      document
        .getElementById("btnAddCustomer")
        .addEventListener("click", function () {
          this.style.display = "none";
          document.getElementById("addCustomerForm").style.display = "flex";
        });

      // Cancel add customer
      document
        .getElementById("btnCancelAddCustomer")
        .addEventListener("click", function () {
          document.getElementById("addCustomerForm").style.display = "none";
          document.getElementById("btnAddCustomer").style.display =
            "inline-block";
          clearAddCustomerForm();
        });

      // Save customer
      document
        .getElementById("btnSaveCustomer")
        .addEventListener("click", async function () {
          const name = document.getElementById("newCustomerName").value.trim();
          const phone = document
            .getElementById("newCustomerPhone")
            .value.trim();
          const allergy = document
            .getElementById("newCustomerAllergy")
            .value.trim();

          if (!name || !phone) {
            UI.showMessage(
              "Vui l√≤ng nh·∫≠p t√™n v√† s·ªë ƒëi·ªán tho·∫°i kh√°ch h√†ng!",
              "error"
            );
            return;
          }

          try {
            UI.showLoading();

            // Th√™m kh√°ch h√†ng v√†o database
            const newCustomer = await API.createKhachHang({
              ten_kh: name,
              sdt: phone,
              di_ung: allergy || "Kh√¥ng c√≥",
            });

            // Reload danh s√°ch kh√°ch h√†ng
            const customersResponse = await API.getKhachHang();
            allCustomers = customersResponse.records || [];
            populateSelects();

            // Ch·ªçn kh√°ch h√†ng v·ª´a t·∫°o
            document.getElementById("customerSelect").value = newCustomer.ma_kh;
            selectedCustomer = newCustomer;
            displayCustomerInfo(selectedCustomer);

            document.getElementById("addCustomerForm").style.display = "none";
            document.getElementById("btnAddCustomer").style.display =
              "inline-block";
            clearAddCustomerForm();

            UI.showMessage("ƒê√£ th√™m kh√°ch h√†ng m·ªõi th√†nh c√¥ng!", "success");
          } catch (error) {
            console.error("L·ªói:", error);
            UI.showMessage(
              "L·ªói khi th√™m kh√°ch h√†ng: " + error.message,
              "error"
            );
          } finally {
            UI.hideLoading();
          }
        });
    }

    // Clear add customer form
    function clearAddCustomerForm() {
      document.getElementById("newCustomerName").value = "";
      document.getElementById("newCustomerPhone").value = "";
      document.getElementById("newCustomerAllergy").value = "";
    }

    // Display customer info
    function displayCustomerInfo(customer) {
      const infoDiv = document.getElementById("customerInfo");
      const cap = customer.cap_thanh_vien || "Bronze";
      const capIcon =
        cap === "VIP"
          ? "üëë"
          : cap === "Gold"
          ? "ü•á"
          : cap === "Silver"
          ? "ü•à"
          : "ü•â";
      const discount =
        cap === "VIP"
          ? "20%"
          : cap === "Gold"
          ? "15%"
          : cap === "Silver"
          ? "10%"
          : "0%";
      const tongTien = customer.tong_tien_da_mua || 0;

      infoDiv.innerHTML = `
        <div class="customer-details" style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-top: 10px;">
          <p><strong>T√™n:</strong> ${customer.ten_kh}</p>
          <p><strong>SƒêT:</strong> ${customer.sdt}</p>
          <p><strong>D·ªã ·ª©ng:</strong> ${customer.di_ung || "Kh√¥ng c√≥"}</p>
          <p><strong>C·∫•p:</strong> ${capIcon} ${cap} <span style="color: #10b981; font-weight: bold;">(Gi·∫£m ${discount})</span></p>
          <p><strong>T·ªïng ƒë√£ mua:</strong> ${formatCurrency(tongTien)}</p>
        </div>
      `;
    }

    // Format currency
    function formatCurrency(amount) {
      return new Intl.NumberFormat("vi-VN", {
        style: "currency",
        currency: "VND",
      }).format(amount);
    }

    // Add medicine to prescription
    function addMedicine() {
      const searchInput = document.getElementById("medicineSearch");
      const doseInput = document.getElementById("dose");
      const daysInput = document.getElementById("days");
      const quantityInput = document.getElementById("quantity");

      const medicineId = searchInput.dataset.selectedId;
      const medicineName = searchInput.value;
      const dose = doseInput.value.trim();
      const days = parseInt(daysInput.value);
      const quantity = parseInt(quantityInput.value);

      if (!medicineId || !dose || !days || !quantity) {
        UI.showMessage("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin thu·ªëc", "error");
        return;
      }

      // Ki·ªÉm tra xem thu·ªëc ƒë√£ c√≥ trong ƒë∆°n ch∆∞a
      const existingMedicine = selectedMedicines.find(
        (m) => m.ma_thuoc == medicineId
      );
      if (existingMedicine) {
        UI.showMessage("Thu·ªëc n√†y ƒë√£ c√≥ trong ƒë∆°n!", "error");
        return;
      }

      const medicine = {
        ma_thuoc: parseInt(medicineId),
        ten_thuoc: medicineName,
        lieu_dung: dose,
        so_ngay: days,
        so_luong: quantity,
      };

      selectedMedicines.push(medicine);
      displayMedicineList();
      clearMedicineForm();
      UI.showMessage("ƒê√£ th√™m thu·ªëc v√†o ƒë∆°n", "success");
    }

    // Display medicine list
    function displayMedicineList() {
      const tbody = document.getElementById("medicineList");
      tbody.innerHTML = "";

      selectedMedicines.forEach((medicine, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${medicine.ten_thuoc}</td>
          <td>${medicine.lieu_dung}</td>
          <td>${medicine.so_ngay}</td>
          <td>${medicine.so_luong}</td>
          <td><button onclick="removeMedicine(${index})" class="btn btn-danger btn-sm">X√≥a</button></td>
        `;
        tbody.appendChild(row);
      });
    }

    // Remove medicine
    function removeMedicine(index) {
      const medicine = selectedMedicines[index];
      if (
        confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a "${medicine.ten_thuoc}" kh·ªèi ƒë∆°n?`)
      ) {
        selectedMedicines.splice(index, 1);
        displayMedicineList();
        UI.showMessage("ƒê√£ x√≥a thu·ªëc kh·ªèi ƒë∆°n", "success");
      }
    }

    // Clear medicine form
    function clearMedicineForm() {
      document.getElementById("medicineSearch").value = "";
      document.getElementById("dose").value = "";
      document.getElementById("days").value = "";
      document.getElementById("quantity").value = "";
      delete document.getElementById("medicineSearch").dataset.selectedId;
      delete document.getElementById("medicineSearch").dataset.selectedPrice;
    }

    // Submit prescription
    async function submitPrescription() {
      // Ki·ªÉm tra nh√¢n vi√™n
      if (!selectedEmployee) {
        UI.showMessage("Vui l√≤ng ch·ªçn nh√¢n vi√™n th·ª±c hi·ªán", "error");
        return;
      }

      // Ki·ªÉm tra thu·ªëc
      if (selectedMedicines.length === 0) {
        UI.showMessage("Vui l√≤ng th√™m thu·ªëc v√†o ƒë∆°n", "error");
        return;
      }

      try {
        UI.showLoading();

        let donThuocData = {
          ma_nv: selectedEmployee.ma_nv,
          ngay_lap: new Date().toISOString().split("T")[0],
          trang_thai: "ƒê√£ l∆∞u",
          ghi_chu: "",
        };

        // X·ª≠ l√Ω theo lo·∫°i kh√°ch h√†ng
        if (customerType === "hoivien") {
          // H·ªôi vi√™n: Ph·∫£i ch·ªçn kh√°ch h√†ng
          if (!selectedCustomer) {
            UI.showMessage("Vui l√≤ng ch·ªçn h·ªôi vi√™n", "error");
            return;
          }
          donThuocData.ma_kh = selectedCustomer.ma_kh;
          donThuocData.di_ung_khach = null; // Kh√¥ng c·∫ßn, l·∫•y t·ª´ b·∫£ng khach_hang
        } else {
          // Kh√°ch v√£ng lai: Kh√¥ng l∆∞u ma_kh, l∆∞u d·ªã ·ª©ng v√†o ƒë∆°n
          const vanglaiAllergy = document
            .getElementById("vanglaiAllergy")
            .value.trim();
          donThuocData.ma_kh = null;
          donThuocData.di_ung_khach = vanglaiAllergy || null;
        }

        // L∆∞u ƒë∆°n thu·ªëc v√†o database
        await API.createDonThuoc(donThuocData, selectedMedicines);

        UI.showMessage("ƒê∆°n thu·ªëc ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng!", "success");

        // Reset form sau 1 gi√¢y
        setTimeout(() => {
          resetForm();
        }, 1000);
      } catch (error) {
        console.error("L·ªói:", error);
        UI.showMessage("L·ªói khi l∆∞u ƒë∆°n thu·ªëc: " + error.message, "error");
      } finally {
        UI.hideLoading();
      }
    }

    // Cancel prescription
    function cancelPrescription() {
      if (
        selectedMedicines.length > 0 ||
        selectedCustomer ||
        selectedEmployee
      ) {
        if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy ƒë∆°n thu·ªëc n√†y?")) {
          resetForm();
          UI.showMessage("ƒê√£ h·ªßy ƒë∆°n thu·ªëc", "success");
        }
      } else {
        UI.showMessage("Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ h·ªßy", "error");
      }
    }

    // Reset form
    function resetForm() {
      // Reset lo·∫°i kh√°ch h√†ng v·ªÅ v√£ng lai
      document.querySelector(
        'input[name="customerType"][value="vanglai"]'
      ).checked = true;
      toggleCustomerType();

      // Reset form v√£ng lai
      document.getElementById("vanglaiName").value = "";
      document.getElementById("vanglaiAllergy").value = "";

      // Reset form h·ªôi vi√™n
      document.getElementById("customerSelect").value = "";
      document.getElementById("customerInfo").innerHTML = "";
      document.getElementById("addCustomerForm").style.display = "none";
      document.getElementById("btnAddCustomer").style.display = "inline-block";

      // Reset chung
      document.getElementById("employeeSelect").value = "";
      document.getElementById("medicineList").innerHTML = "";
      selectedMedicines = [];
      selectedCustomer = null;
      selectedEmployee = null;
      clearMedicineForm();
    }
  </script>
</html>
