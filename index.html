<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PharmaT - Quáº£n LÃ½ Tiá»‡m Thuá»‘c Tá»± Äá»™ng</title>
    <link rel="stylesheet" href="frontend/src/assets/css/home.css" />
    <link
      rel="stylesheet"
      href="frontend/src/assets/css/common-responsive.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar">
      <div class="menu-toggle" onclick="toggleSidebar()">
        <i class="fa-solid fa-bars"></i>
      </div>
      <div class="logo">
        <img
          src="frontend/src/assets/images/logo.png"
          alt="PharmaT Logo"
          class="logo-img"
          onclick="window.location.href='index.html'"
        />
      </div>
      <div class="page-title">
        <h1>Dashboard Quáº£n LÃ½ Tiá»‡m Thuá»‘c</h1>
      </div>
    </nav>

    <!-- Sidebar -->
    <aside class="sidebar">
      <ul>
        <li>
          <a href="index.html" onclick="setActive(this)">ğŸ  Trang chá»§</a>
        </li>
        <li>
          <a href="frontend/src/views/warehouse.html" onclick="setActive(this)"
            >ğŸ“¦ Kho thuá»‘c</a
          >
        </li>
        <li>
          <a
            href="frontend/src/views/prescriptions.html"
            onclick="setActive(this)"
            >ğŸ“ ÄÆ¡n thuá»‘c</a
          >
        </li>
        <li>
          <a href="frontend/src/views/employees.html" onclick="setActive(this)"
            >ğŸ‘¥ NhÃ¢n viÃªn</a
          >
        </li>
        <li>
          <a href="frontend/src/views/members.html" onclick="setActive(this)"
            >ğŸ’ Há»™i viÃªn</a
          >
        </li>
        <li>
          <a href="frontend/src/views/checkout.html" onclick="setActive(this)"
            >ğŸ’³ Thanh toÃ¡n</a
          >
        </li>
        <li>
          <a href="frontend/src/views/reports.html" onclick="setActive(this)"
            >ğŸ“ˆ BÃ¡o cÃ¡o & Thá»‘ng kÃª</a
          >
        </li>
        <li>
          <a href="frontend/src/views/chatbox.html" onclick="setActive(this)"
            >ğŸ¤– Chatbox cáº£nh bÃ¡o</a
          >
        </li>
      </ul>

      <!-- Logout Button -->
      <div class="sidebar-footer">
        <a
          href="frontend/src/views/login.html"
          class="logout-btn"
          onclick="logout()"
        >
          <i class="fa-solid fa-sign-out-alt"></i>
          ÄÄƒng xuáº¥t
        </a>
      </div>
    </aside>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>

    <!-- Main Content -->
    <main class="main-content">
      <div class="dashboard">
        <div class="dashboard-header">
          <p>
            ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i há»‡ thá»‘ng quáº£n lÃ½ tiá»‡m thuá»‘c tá»± Ä‘á»™ng tÃ­ch há»£p AI cáº£nh bÃ¡o hÃ ng tá»“n
          </p>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">ğŸ’Š</div>
            <div class="stat-info">
              <h3 id="total-medicines">1,234</h3>
              <p>Tá»•ng sá»‘ thuá»‘c</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ğŸ“¦</div>
            <div class="stat-info">
              <h3 id="today-orders">567</h3>
              <p>ÄÆ¡n hÃ ng hÃ´m nay</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ğŸ’°</div>
            <div class="stat-info">
              <h3 id="month-revenue">12.5M</h3>
              <p>Doanh thu thÃ¡ng</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">âš ï¸</div>
            <div class="stat-info">
              <h3 id="alerts">23</h3>
              <p>Cáº£nh bÃ¡o</p>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
          <h2>ğŸš€ Thao tÃ¡c nhanh</h2>
          <div class="actions-grid">
            <a href="frontend/src/views/warehouse.html" class="action-card">
              <div class="action-icon">ğŸ“¦</div>
              <h3>Quáº£n lÃ½ Kho</h3>
              <p>ThÃªm, sá»­a, xÃ³a thuá»‘c</p>
            </a>
            <a href="frontend/src/views/prescriptions.html" class="action-card">
              <div class="action-icon">ğŸ“</div>
              <h3>Táº¡o ÄÆ¡n Thuá»‘c</h3>
              <p>Táº¡o Ä‘Æ¡n thuá»‘c má»›i</p>
            </a>
            <a href="frontend/src/views/checkout.html" class="action-card">
              <div class="action-icon">ğŸ’³</div>
              <h3>Thanh ToÃ¡n</h3>
              <p>Xá»­ lÃ½ thanh toÃ¡n</p>
            </a>
            <a href="frontend/src/views/reports.html" class="action-card">
              <div class="action-icon">ğŸ“Š</div>
              <h3>BÃ¡o CÃ¡o</h3>
              <p>Xem thá»‘ng kÃª</p>
            </a>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="recent-activity">
          <h2>ğŸ“‹ Hoáº¡t Ä‘á»™ng gáº§n Ä‘Ã¢y</h2>
          <div class="activity-list">
            <div class="activity-item">
              <div class="activity-icon">â•</div>
              <div class="activity-content">
                <h4>ThÃªm thuá»‘c má»›i</h4>
                <p>Paracetamol 500mg - 10:30 AM</p>
              </div>
            </div>
            <div class="activity-item">
              <div class="activity-icon">ğŸ’³</div>
              <div class="activity-content">
                <h4>Thanh toÃ¡n Ä‘Æ¡n hÃ ng</h4>
                <p>ÄÆ¡n #1234 - 150,000 VNÄ - 10:15 AM</p>
              </div>
            </div>
            <div class="activity-item">
              <div class="activity-icon">âš ï¸</div>
              <div class="activity-content">
                <h4>Cáº£nh bÃ¡o tá»“n kho</h4>
                <p>Amoxicillin sáº¯p háº¿t hÃ ng - 09:45 AM</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script src="frontend/src/assets/js/sidebar.js"></script>
    <script src="frontend/src/config/supabase.js"></script>
    <script src="frontend/src/config/api.js"></script>
    <script src="frontend/src/config/app.js"></script>
    <script src="frontend/src/assets/js/home.js"></script>
    <script>
      // Initialize sidebar functionality
      function toggleSidebar() {
        const sidebar = document.querySelector(".sidebar");
        const overlay = document.querySelector(".sidebar-overlay");
        sidebar.classList.toggle("active");
        overlay.classList.toggle("active");
      }

      function closeSidebar() {
        const sidebar = document.querySelector(".sidebar");
        const overlay = document.querySelector(".sidebar-overlay");
        sidebar.classList.remove("active");
        overlay.classList.remove("active");
      }

      function setActive(element) {
        // Remove active class from all sidebar links
        document.querySelectorAll(".sidebar a").forEach((link) => {
          link.classList.remove("active");
        });
        // Add active class to clicked link
        element.classList.add("active");
      }

      function logout() {
        // Clear any stored data
        localStorage.clear();
        // Redirect to login page
        window.location.href = "frontend/src/views/login.html";
      }

      // Load statistics when page loads
      document.addEventListener("DOMContentLoaded", async function () {
        try {
          // Try to load real statistics if API is available
          if (typeof API !== "undefined") {
            const stats = await API.getStatistics();

            // Update statistics
            document.getElementById("total-medicines").textContent =
              stats.totalMedicines.toLocaleString();
            document.getElementById("today-orders").textContent =
              stats.todayOrders.toLocaleString();
            document.getElementById("month-revenue").textContent =
              (stats.monthRevenue / 1000000).toFixed(1) + "M";
            document.getElementById("alerts").textContent =
              stats.alerts.toLocaleString();

            // Check and create alerts
            await API.checkAndCreateAlerts();
          } else {
            // Use sample data if API is not available
            console.log("API not available, using sample data");
          }
        } catch (error) {
          console.error("Error loading statistics:", error);
          // Continue with default values
        }

        // Set current page as active
        const currentPageLink = document.querySelector('a[href="index.html"]');
        if (currentPageLink) {
          setActive(currentPageLink);
        }
      });

      // Auto-refresh statistics every 30 seconds
      setInterval(async function () {
        try {
          if (typeof API !== "undefined") {
            const stats = await API.getStatistics();
            document.getElementById("total-medicines").textContent =
              stats.totalMedicines.toLocaleString();
            document.getElementById("today-orders").textContent =
              stats.todayOrders.toLocaleString();
            document.getElementById("month-revenue").textContent =
              (stats.monthRevenue / 1000000).toFixed(1) + "M";
            document.getElementById("alerts").textContent =
              stats.alerts.toLocaleString();
          }
        } catch (error) {
          console.error("Error refreshing statistics:", error);
        }
      }, 30000);
    </script>
  </body>
</html>
